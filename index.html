<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
    <style>
    * {
      margin: 0;
      padding: 0;
      }
    </style>
  </head>
  <body>
    <script>
    var config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        pixelArt: true,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 }
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);
    var emitter; // First Emitter. - Emitters will overlay each other giving a cool effect.
    var emitterTwo; // Second Emitter.
    var rocket; // Player.
    var background; // Background tiles.
    var score = 1; // Score.
    var points = 1; // Score to increase by each button press.
    var timer;
    var timerText;
    var tower;
    var ground;

    function preload () // preload
    {
        this.load.audio('theme', ['assets/audio/SoundtrackSpace.wav']);
        this.load.image('particle', 'assets/textures/particle.png'); // Preloading the particle for the emitters.
        this.load.image('rocket', 'assets/textures/rocket.png'); // Preloading the rocket.
        this.load.image('space', 'assets/textures/space.png'); // Space background.
        this.load.image('tower', 'assets/textures/towerFull.png'); // Preload the tower asset.
        this.load.image('ground', 'assets/textures/ground.png'); // Preload the ground asset.
    }

    function create ()
    {
      var audio = this.sound.add('theme'); // Add the music into the game.
      audio.setVolume(0.2); // Set the volume.
      audio.setLoop(true); // Loop the music.
      audio.play(); // Play the music.

       // Background to use. Using a tile sprite.
       background = this.add.tileSprite(0, 0, this.sys.game.canvas.width, this.sys.game.canvas.height, 'space').setOrigin(0, 0);

       var titleText = this.add.text(25, 25, 'A space game'); // Some Text.
       var scoreText = this.add.text(100, 100, 'Score: 1'); // Score text - will be updated.
       titleText.setTint(0xff00ff, 0xffff00, 0x0000ff, 0xff0000); // Tint.
       scoreText.setTint(0xff0000, 0x0000ff, 0xffff00, 0xff00ff); // Tint.
       this.physics.world.setBoundsCollision(true, true, true, true); // World collisions.

        var particles = this.add.particles('particle'); // Particle to use in the emitter.
        emitter = particles.createEmitter({ // The emitter.
          speed: 0, // Speed of the particles.
          scale: {start: 1.5, end: 0}, // How big the particles will be at start and what theyll shrink to.
          blendMode: 'ADD', // Blend mode to use.
          tint: 0x0094FF, // Tint to use.
          gravityY: 400 // Gravity of the emitter particles on the Y axis.
        });

        emitterTwo = particles.createEmitter({ // The emitter.
          speed: 0, // Speed of the particles.
          scale: {start: 1.5, end: 0}, // How big the particles will be at start and what theyll shrink to.
          blendMode: 'ADD', // Blend mode to use.
          tint: 0xFF5D00, // Tint to use.
          gravityY: 400 // Gravity of the emitter particles on the Y axis.
        });

        rocket = this.physics.add.sprite(this.sys.game.canvas.width/2, this.sys.game.canvas.height/1.25, 'rocket'); // Rocket sprite.
        rocket.scaleX = 2; // Make the rocket bigger.
        rocket.scaleY = 2; // Make the rocket bigger.
        rocket.setCollideWorldBounds(true); // The world collision bounds.

        tower = this.physics.add.sprite(this.sys.game.canvas.width/2, this.sys.game.canvas.height/1.25, 'tower');
        tower.scaleX = 2; // Scale the tower on the X axis.
        tower.scaleY = 2; // Scale the tower on the Y axis.
        tower.x -= 12; // Move the tower on the x axis.
        tower.y -= 64; // Move the tower on the y axis.

        ground = this.physics.add.sprite(this.sys.game.canvas.width/2, this.sys.game.canvas.height/1.25, 'ground');
        ground.y += 16;

        rocket.setOrigin(0.5, 1); // Origin of the rocket sprite. This for the positioning of the emitters.
        emitter.startFollow(rocket); // Emitter should follow the rocket.
        emitterTwo.startFollow(rocket); // Emitter should follow the rocket.

        this.input.on('pointerdown', function(pointer){ // When the mouse button is pressed.
          score += points; // Increase the score.
          scoreText.setText('Score: ' + score); // Update the text with the new score.
          emitter.setSpeed(score); //set particle emission speed to match rocket speed
          emitterTwo.setSpeed(score); //set particle emission speed to match rocket speed
        });

        //Fade camera in
        this.cameras.main.fadeIn(1000);

        timerText = this.add.text(300, 300); // Make Text.
        timer = this.time.delayedCall(30000, onEvent, [], this); // Length of timer, what to do when its done.
    }

    function update()
    {
      background.tilePositionY -= score; // Constantly move the background.
      timerText.setText('Timer: ' + timer.getProgress().toString().substr(0, 4)); // Set the text to the timer progress. Cut the string down.

      //tower.setVelocityY(score*20);
    }

    function onEvent()
    {
      var finalText = this.add.text(200, 600, 'Your score was: ' + score); // Display the players final score when the timer is complete.
      timerText.setTint(0xff0000, 0x0000ff, 0xffff00, 0xff00ff); // Set the text tint
    }

    </script>
  </body>
</html>
